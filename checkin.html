<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ¬¡å›ãƒ‰ãƒªãƒ³ã‚¯ç„¡æ–™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
      background:#f6f6f6;
      margin:0;
      padding:14px 12px 18px;
      text-align:center;
      color:#111;
    }
    .wrap{max-width:640px;margin:0 auto;}
    .card{
      background:#fff;
      border-radius:26px;
      padding:18px 16px 16px;
      box-shadow:0 10px 30px rgba(0,0,0,.07);
    }
    .title{font-size:24px;font-weight:900;margin:0 0 6px;}
    .sub{font-size:17px;font-weight:900;margin:0 0 6px;}
    .lead{font-size:17px;font-weight:900;margin:4px 0 6px;line-height:1.25;}

    .note{
      background:#fff3cd;
      border-radius:14px;
      padding:11px 12px;
      font-size:15px;
      font-weight:900;
      margin:6px 0 8px;
      line-height:1.35;
    }

    .muted{font-size:13px;color:#666;margin:4px 0 10px;}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;}

    .line{
      font-size:14px;
      font-weight:900;
      margin:8px 0 6px;
      line-height:1.35;
    }
    .pill{
      display:inline-block;
      padding:3px 10px;
      border-radius:999px;
      background:#eef3ff;
      font-weight:900;
    }

    .qr{
      width:100%;
      max-width:250px; /* iPhone SEã§ã‚‚ã¯ã¿å‡ºã—ã«ãã„ */
      margin:6px auto 0;
      display:block;
    }
    .footer{font-size:13px;color:#888;margin-top:6px;}

    @media (max-height: 700px) {
      .title{font-size:23px;}
      .lead{font-size:16px;}
      .note{font-size:14px; padding:10px 11px;}
      .qr{max-width:235px;}
      .muted{margin-bottom:8px;}
      .line{font-size:13px;}
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="title">ğŸ¥¤ æ¬¡å›ãƒ‰ãƒªãƒ³ã‚¯ç„¡æ–™</div>
    <div class="sub">2/24 LIVE ç‰¹å…¸</div>
    <div class="lead">ã“ã®ç”»é¢ã‚’ã‚¹ã‚¯ã‚·ãƒ§ä¿å­˜ã—ã¦ã­</div>

    <div class="note">
      2/24æ¥å ´æ™‚ã«ã“ã®ç”»é¢ã‚’è¦‹ã›ã‚‹ã¨<br>
      <strong>ãƒ‰ãƒªãƒ³ã‚¯1æ¯ç„¡æ–™ï¼ˆ1å›ï¼‰</strong> ğŸº<br>
      <strong>å‹é”ã‚’é€£ã‚Œã¦ããŸã‚‰å‹é”ã‚‚1æ¯ç„¡æ–™</strong>
    </div>

    <div class="muted">â€»ã‚¹ã‚¿ãƒƒãƒ•ãŒèª­ã¿å–ã‚Šã¾ã™</div>

    <!-- â‘  big uid ã‚’å‰Šé™¤ã€‚å¿…è¦ãª2ã¤ã ã‘è¡¨ç¤º -->
    <div class="line">ã‚¹ã‚¿ãƒƒãƒ•ç¢ºèªç”¨ï¼š<span class="pill mono" id="codeLine">code: ----</span></div>
    <div class="line">ã‚ãªãŸã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š<span class="pill mono" id="myRef">----</span></div>

    <img id="qr" class="qr" alt="ã‚¹ã‚¿ãƒƒãƒ•èª­ã¿å–ã‚Šç”¨QR">
    <div class="footer">ã“ã®ç”»é¢ã¯å†ç™ºè¡Œã§ãã¾ã›ã‚“</div>
  </div>
</div>

<script>
  const params = new URLSearchParams(location.search);
  let spot = (params.get("spot") || "uk")
    .toLowerCase()
    .replace(/[^a-z0-9]/g,"")
    .slice(0,2);

  const alphabet = "23456789ABCDEFGHJKLMNPQRSTUVWXYZ";
  const rand4 = () => {
    let s = "";
    for(let i=0;i<4;i++) s += alphabet[Math.floor(Math.random()*alphabet.length)];
    return s;
  };

  // 2/16æ¥å ´è€…ã®uidï¼ˆ=ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã«ã‚‚ä½¿ã†ï¼‰
  const uid = rand4();
  const token = uid + spot;

  // ç™ºè¡Œæ™‚åˆ»ï¼ˆUnixåˆ† â†’ base36ï¼‰
  const issuedMin = Math.floor(Date.now() / 60000);
  const t = issuedMin.toString(36);

  // redeem URL
  const base = location.origin + location.pathname.replace(/[^\/]+$/, "");
  const redeemUrl = `${base}redeem.html?c=${encodeURIComponent(token)}&t=${t}`;

  // QRç”Ÿæˆ
  document.getElementById("qr").src =
    "https://barcode.tec-it.com/barcode.ashx" +
    "?data=" + encodeURIComponent(redeemUrl) +
    "&code=QRCode";

  // è¡¨ç¤º
  document.getElementById("codeLine").textContent = `code: ${uid.toLowerCase()}-${spot}`;
  document.getElementById("myRef").textContent = uid.toLowerCase();
</script>
</body>
</html>

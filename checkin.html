<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ¬¡å›ãƒ‰ãƒªãƒ³ã‚¯å‰²å¼•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      --bg:#f6f6f6;
      --card:#ffffff;
      --text:#111;
      --muted:#777;
      --accent:#fff3cd;
      --radius:28px;
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
      background:var(--bg);
      margin:0;
      padding:16px 12px 22px; /* å°‘ã—è©°ã‚ã‚‹ */
      color:var(--text);
      text-align:center;
    }
    .wrap{max-width:640px;margin:0 auto;}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:22px 18px 20px; /* å°‘ã—è©°ã‚ã‚‹ */
      box-shadow:0 10px 30px rgba(0,0,0,.07);
    }
    .title{
      display:flex;align-items:center;justify-content:center;gap:10px;
      font-size:26px;font-weight:900;letter-spacing:.02em;margin:4px 0 10px;
    }
    .badge{
      width:32px;height:32px;border-radius:10px;
      display:inline-flex;align-items:center;justify-content:center;
      background:#ffe97a;box-shadow:0 6px 16px rgba(0,0,0,.08);
      font-size:18px;
    }
    .sub{font-size:20px;font-weight:900;margin:0 0 12px;}
    .lead{
      font-size:20px;           /* 22â†’20 */
      font-weight:900;
      line-height:1.4;
      margin:6px 0 10px;        /* è©°ã‚ã‚‹ */
    }
    .note{
      background:var(--accent);
      border-radius:14px;
      padding:14px 14px;        /* è©°ã‚ã‚‹ */
      margin:10px 0 10px;       /* è©°ã‚ã‚‹ */
      font-size:18px;           /* 20â†’18 */
      font-weight:900;
      line-height:1.45;
    }
    .note .small{
      display:block;
      font-size:16px;
      font-weight:800;
      margin-bottom:6px;
    }
    .muted{
      color:var(--muted);
      font-size:16px;
      font-weight:700;
      margin:8px 0 6px;         /* è©°ã‚ã‚‹ */
    }

    /* codeè¡¨ç¤ºï¼ˆQRã®ä¸Šã«ç½®ãï¼‰ */
    .codeBig{
      font-size:34px;
      font-weight:900;
      letter-spacing:.08em;
      margin:10px 0 2px;
    }
    .codeLine{
      color:#666;
      font-size:16px;
      font-weight:800;
      margin:0 0 8px;           /* QRã¨ã®è·é›¢ */
    }

    /* QRã¯å°ã•ã‚ã«ã—ã¦ã€Œ1ã‚¹ã‚¯ã‚·ãƒ§ã«åã‚ã‚‹ã€ */
    .qr{
      width:100%;
      max-width:300px;          /* 420â†’300 */
      height:auto;
      margin:6px auto 0;
      display:block;
    }

    /* å°ã•ã„ç”»é¢ï¼ˆiPhone SE / miniï¼‰ä¿é™º */
    @media (max-height: 700px) {
      .qr{max-width:260px;}
      .title{font-size:24px;}
      .lead{font-size:19px;}
      .note{font-size:17px;}
      .codeBig{font-size:32px;}
    }

    .footer{
      color:#888;
      font-size:18px;
      font-weight:800;
      margin-top:10px;
    }
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="title"><span class="badge">ğŸ«</span><span>æ¬¡å›ãƒ‰ãƒªãƒ³ã‚¯å‰²å¼•</span></div>

      <div class="sub">2/24 LIVE å†æ¥å ´ç‰¹å…¸</div>

      <div class="lead">
        ã“ã®ç”»é¢ã‚’<br>ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
      </div>

      <div class="note">
        <span class="small">2/24ã®æ¥å ´æ™‚ã«</span>
        ã“ã®ç”»é¢ã‚’è¦‹ã›ã‚‹ã¨<span>é™å®š1å›</span><br>
        <span>ãƒ‰ãƒªãƒ³ã‚¯å‰²å¼•</span>ãŒä½¿ãˆã¾ã™ ğŸº
      </div>

      <div class="muted">â€» ã‚¹ã‚¿ãƒƒãƒ•ãŒèª­ã¿å–ã‚Šã¾ã™ï¼ˆãŠå®¢æ§˜ã¯æ“ä½œä¸è¦ï¼‰</div>

      <!-- â˜… code ã‚’QRã®ä¸Šã«ç§»å‹• -->
      <div class="codeBig mono" id="codeBig">----</div>
      <div class="codeLine" id="codeLine">code: ----</div>

      <img id="qr" class="qr" alt="ã‚¹ã‚¿ãƒƒãƒ•èª­ã¿å–ã‚Šç”¨QR">

      <div class="footer">ã“ã®ç”»é¢ã¯å†ç™ºè¡Œã§ãã¾ã›ã‚“</div>
    </div>
  </div>

  <script>
    // ãŠå®¢ã•ã¾ç”¨ï¼ˆ2/16ï¼‰
    // - QRã‚’èª­ã‚€ãŸã³ uid(4) ã‚’ç™ºè¡Œ
    // - spot(2) ã¨åˆä½“ã—ã¦ token(6)
    // - QRã®ä¸­èº«ã¯ redeem.html?c=TOKEN ã®URLï¼ˆã‚¹ã‚¿ãƒƒãƒ•ãŒèª­ã‚€ã¨redeemã¸ï¼‰
    // - ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã—ãªã„

    const params = new URLSearchParams(window.location.search);
    let spot = (params.get("spot") || "uk").toLowerCase();
    spot = spot.replace(/[^a-z0-9]/g, "").slice(0, 2);

    const spotNameMap = {
      st: "stage",
      en: "entrance",
      dr: "drink",
      br: "bar",
      md: "merch",
      fl: "floor",
      uk: "unknown"
    };
    const spotName = spotNameMap[spot] || spot;

    // uidï¼š4æ–‡å­—ï¼ˆèª­ã¿é–“é•ã„ã—ã¥ã‚‰ã„ï¼‰
    const alphabet = "23456789ABCDEFGHJKLMNPQRSTUVWXYZ"; // 0,1,I,Oã‚’é¿ã‘ã‚‹
    const rand4 = () => {
      let s = "";
      for (let i = 0; i < 4; i++) s += alphabet[Math.floor(Math.random() * alphabet.length)];
      return s;
    };
    const uid = rand4();

    // tokenï¼š6æ–‡å­—
    const token = `${uid}${spot}`;

    // redeem URLï¼ˆåŒä¸€ã‚ªãƒªã‚¸ãƒ³æƒ³å®šï¼šGitHub Pagesã§OKï¼‰
    const base = location.origin + location.pathname.replace(/[^\/]+$/, "");
    const redeemUrl = `${base}redeem.html?c=${encodeURIComponent(token)}`;

    // QRè¡¨ç¤ºï¼ˆtec-itï¼‰
    const qr = document.getElementById("qr");
    qr.src =
      "https://barcode.tec-it.com/barcode.ashx" +
      "?data=" + encodeURIComponent(redeemUrl) +
      "&code=QRCode" +
      "&translate-esc=on";

    // è¡¨ç¤ºï¼ˆè¦‹ãŸç›®ã¯å°æ–‡å­—å¯„ã›ï¼‰
    document.getElementById("codeBig").textContent = uid.toLowerCase();
    document.getElementById("codeLine").textContent = `code: ${uid.toLowerCase()}-${spotName}`;
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ¬¡å›ãƒ‰ãƒªãƒ³ã‚¯å‰²å¼•</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 16px;
      text-align: center;
    }
    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 24px;
      max-width: 520px;
      margin: 0 auto;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    h1 {
      font-size: 22px;
      margin: 0 0 8px;
    }
    .event {
      font-weight: bold;
      margin: 0 0 16px;
    }
    .notice {
      background: #fff3cd;
      border-radius: 8px;
      padding: 12px;
      margin: 16px 0;
      font-size: 14px;
      line-height: 1.5;
    }
    #staffBC {
      display: block;
      width: 100%;
      max-width: 520px;
      height: auto;
      margin: 10px auto 0;
    }
    small {
      display: block;
      color: #666;
      font-size: 12px;
      margin-top: 10px;
      line-height: 1.4;
    }
    #debug {
      margin-top: 10px;
      color: #666;
      font-size: 12px;
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>ğŸ« æ¬¡å›ãƒ‰ãƒªãƒ³ã‚¯å‰²å¼•</h1>
    <div class="event">2/24 LIVE å†æ¥å ´ç‰¹å…¸</div>

    <p>
      ã“ã®ç”»é¢ã‚’<br>
      <strong>ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã—ã¦ä¿å­˜</strong>ã—ã¦ãã ã•ã„ã€‚
    </p>

    <div class="notice">
      2/24ã®æ¥å ´æ™‚ã«ã“ã®ç”»é¢ã‚’è¦‹ã›ã‚‹ã¨<br>
      <strong>ãƒ‰ãƒªãƒ³ã‚¯å‰²å¼•</strong>ãŒä½¿ãˆã¾ã™ ğŸºï¼ˆé™å®š1å›ï¼‰
    </div>

    <small>â€» ã‚¹ã‚¿ãƒƒãƒ•ãŒèª­ã¿å–ã‚Šã¾ã™ï¼ˆãŠå®¢æ§˜ã¯æ“ä½œä¸è¦ï¼‰</small>
    <img id="staffBC" alt="ã‚¹ã‚¿ãƒƒãƒ•èª­ã¿å–ã‚Šç”¨ãƒãƒ¼ã‚³ãƒ¼ãƒ‰">

    <div id="debug"></div>

    <small>
      ã†ã¾ãèª­ã¿å–ã‚Œãªã„å ´åˆï¼š<br>
      ä¸‹ã®ã‚³ãƒ¼ãƒ‰ï¼ˆ<span class="mono">token</span>ï¼‰ã‚’ã‚¹ã‚¿ãƒƒãƒ•ãŒæ‰‹å…¥åŠ›ã—ã¦ã‚‚OK
    </small>
  </div>

  <script>
    // --- spotï¼šURLã§æŒ‡å®šï¼ˆã‚³ãƒ¼ãƒ‰ã¯é‹ç”¨ã§å¤‰ãˆã‚‰ã‚Œã‚‹ï¼‰ ---
    // ä¾‹: checkin.html?spot=st / ?spot=en / ?spot=dr / ?spot=ch
    const params = new URLSearchParams(window.location.search);
    let spot = (params.get("spot") || "uk").toLowerCase();
    spot = spot.replace(/[^a-z0-9]/g, "").slice(0, 2); // 2æ–‡å­—ã«åˆ¶é™ï¼ˆçŸ­ãä¿ã¤ï¼‰

    // --- uidï¼šç«¯æœ«ã«ä¿å­˜ï¼ˆ5æ–‡å­—ï¼‰ ---
    let uid = localStorage.getItem("otoniwa_uid");
    if (!uid) {
      uid = Math.random().toString(36).substring(2, 7); // 5æ–‡å­—
      localStorage.setItem("otoniwa_uid", uid);
    }

    // --- tokenï¼š7æ–‡å­—ï¼ˆuid5 + spot2ï¼‰ ---
    const token = `${uid}${spot}`;

    // --- ã‚¹ã‚¿ãƒƒãƒ•ãŒé–‹ãURLï¼ˆçŸ­ã„ã‚¯ã‚¨ãƒªå c ã‚’ä½¿ã†ï¼‰ ---
    const staffUrl =
      `https://nakanakaly.github.io/otoniwa-checkin/redeem.html?c=${encodeURIComponent(token)}`;

    // --- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆCode128ï¼‰ ---
    // ã‚‚ã—ã¾ã èª­ã¿å–ã‚ŠãŒå³ã—ã‘ã‚Œã°ã€code=PDF417 ã«å¤‰ãˆã‚‹ã¨ã‹ãªã‚ŠçŸ­ããªã‚‹
    const img = document.getElementById("staffBC");
    img.src =
      "https://barcode.tec-it.com/barcode.ashx" +
      "?data=" + encodeURIComponent(staffUrl) +
      "&code=Code128" +
      "&translate-esc=on";

    // --- ç›®è¦–ç”¨è¡¨ç¤ºï¼ˆç¾å ´ã®ä¿é™ºï¼‰ ---
    document.getElementById("debug").innerHTML =
      `token: <span class="mono">${token}</span>ã€€/ spot: <span class="mono">${spot}</span>`;
  </script>
</body>
</html>
